name: Manual Build

on:
  workflow_dispatch:  # Manual trigger only
    inputs:
      create_release:
        description: 'Create a release after building'
        required: false
        default: false
        type: boolean

permissions:
  contents: write

jobs:
  build-test:
    name: Test Build
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup MinGW
      uses: msys2/setup-msys2@v2
      with:
        msystem: MINGW64
        update: true
        install: >-
          mingw-w64-x86_64-gcc
          mingw-w64-x86_64-make
          zip
          
    - name: Install Raylib
      shell: msys2 {0}
      run: |
        git clone --depth 1 --branch 5.0 https://github.com/raysan5/raylib.git
        cd raylib/src
        mingw32-make PLATFORM=PLATFORM_DESKTOP
        
    - name: Build Asteroids
      shell: msys2 {0}
      run: |
        export RAYLIB_PATH=$(pwd)/raylib
        mingw32-make RAYLIB_PATH=$RAYLIB_PATH PROJECT_NAME=asteroids OBJS=src/*.cpp
        
        # Create test build package with DLLs
        mkdir test-build
        cp asteroids.exe test-build/
        cp /mingw64/bin/libgcc_s_seh-1.dll test-build/
        cp /mingw64/bin/libstdc++-6.dll test-build/
        cp /mingw64/bin/libwinpthread-1.dll test-build/
        
        echo "Test build package contents:"
        ls -la test-build/
        
    - name: Upload Build Artifact
      uses: actions/upload-artifact@v4
      with:
        name: asteroids-test-build
        path: test-build/